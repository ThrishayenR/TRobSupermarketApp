<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Past Orders</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

  <%- include("partials/navbar") %>

  <div class="container mt-4">
    <h2>Your Live Orders</h2>

    <% if (orders.length === 0) { %>
      <p class="mt-3">You currently have no orders.</p>
    <% } else { %>

      <% orders.forEach(order => { %>

        <div class="card mt-4 shadow-sm">

          <!-- Card Header -->
          <div class="card-header d-flex justify-content-between align-items-center">

            <div>
              <strong>Order #<%= order.id %></strong>

              <!-- Status Badge -->
              <span class="badge bg-success ms-2">Completed</span>
            </div>

            <span class="text-muted">
              <%= order.orderDate 
                    ? new Date(order.orderDate).toLocaleString('en-GB', { dateStyle: "medium", timeStyle: "short" }) 
                    : "No date available" %>
            </span>
          </div>

          <!-- Card Body -->
          <div class="card-body p-0">
            <table class="table table-bordered mb-0 align-middle">
              <thead class="table-light">
                <tr>
                  <th style="width: 120px;">Image</th>
                  <th>Product</th>
                  <th>Quantity</th>
                  <th>Price</th>
                  <th>Line Total</th>
                </tr>
              </thead>

              <tbody>

                <% 
                  let total = 0;
                  order.items.forEach(item => { 
                    const lineTotal = item.price * item.quantity;
                    total += lineTotal;
                %>

                <tr>
                  <td>
                    <% if (item.image) { %>
                      <img 
                        src="images/<%= item.image %>" 
                        class="img-thumbnail"
                        style="width: 100px; height: 100px; object-fit: cover;"
                      >
                    <% } else { %>
                      <span class="text-muted">No image</span>
                    <% } %>
                  </td>

                  <td><%= item.productName %></td>
                  <td><%= item.quantity %></td>
                  <td>$<%= item.price.toFixed(2) %></td>
                  <td>$<%= lineTotal.toFixed(2) %></td>
                </tr>

                <% }) %>

              </tbody>
            </table>
          </div>

          <!-- Total Footer -->
          <div class="card-footer text-end">
            <strong>Total Amount: </strong>
            <span class="ms-2">$<%= total.toFixed(2) %></span>
          </div>

        </div>

      <% }) %>

    <% } %>

  </div>

  <%- include("partials/footer") %>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>