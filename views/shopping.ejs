<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    
    <title>Supermarket App - Shop</title>
    
    <style>
        /* Global & Typography */
        body {
            background-color: #f7f7f7;
            font-family: 'Inter', sans-serif;
        }
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600; 
        }

        /* Sticky Footer Fix (Requires d-flex flex-column min-vh-100 on body) */
        .flex-grow-1 {
            flex-grow: 1;
        }

        /* Product Card Styling */
        .product-card {
            background-color: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            height: 100%; /* Important for equal height in the grid */
            transition: box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .product-card:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .product-card img {
            max-width: 100%;
            height: 120px; /* Fixed height for consistent look */
            object-fit: contain;
            margin-bottom: 10px;
        }

        .product-name a {
            font-weight: 500;
            color: #333;
            text-decoration: none;
            display: block; /* Allows margin to work */
            margin-bottom: 5px;
        }

        .product-price {
            font-size: 1.25rem; /* Larger price */
            font-weight: 700;
            color: #008000; /* Green for price (Freshness) */
            margin-bottom: 10px;
        }

        /* Buy Button (Olive Green) */
        .btn-custom-olive {
            background-color: #8fa83e;
            border-color: #8fa83e;
            color: white;
            font-weight: bold;
            border-radius: 4px; 
            width: 100%;
            padding: 8px;
        }
        .btn-custom-olive:hover {
            background-color: #799131; 
            border-color: #799131;
            color: white;
        }

        /* Quantity Input Group Fixes */
        .input-group input[type="number"] {
            border-left: none;
            border-right: none;
            /* Ensures number input doesn't look weirdly sized */
            height: 38px;
            padding: 0;
        }
        .input-group .btn-outline-secondary {
            border-color: #ced4da !important;
        }

    </style>
</head>

<body class="d-flex flex-column min-vh-100">
    
    <%- include("partials/navbar") %>

    <div class="container mt-3">
        <% if (messages && messages.length > 0) { %>
            <div class="alert alert-danger">
                <% messages.forEach(function(message) { %>
                    <p><%= message %></p>
                <% }); %>
            </div>
        <% } %>

        <% if (success && success.length > 0) { %>
            <div class="alert alert-success">
                <% success.forEach(function(message) { %>
                    <p><%= message %></p>
                <% }); %>
            </div>
        <% } %>
    </div>
    
    <div class="container flex-grow-1 mt-4">
        <p>Welcome, <%= user.username %> (<%= user.role %>)</p>
        <div class="text-center mb-4">
            <h2>Products from Supermarket</h2>
        </div>

        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-4 mb-5">
            
            <% for(let i=0; i < products.length; i++) { %>
                <div class="col">
                    <div class="product-card">
                        
                        <div class="product-header">
                            <a href="/product/<%= products[i].id %>" >
                                <img src = "images/<%= products[i].image %>" alt="<%= products[i].productName %>">
                            </a>
                        </div>

                        <div class="product-details mt-auto">
                            <h5 class="product-name">
                                <a href="/product/<%= products[i].id %>" >
                                    <%= products[i].productName %>
                                </a>
                            </h5>
                            
                            <div class="product-price">
                                $<%= products[i].price.toFixed(2) %>
                            </div>
                            <div class="mb-2">
                                <% if (products[i].quantity === 0) { %>
                                    <span class="badge bg-danger text-white" style="font-size: 0.8rem;">Out of stock</span>
                                <% } else { %>
                                    <span class="text-secondary small">In stock: <%= products[i].quantity %> units</span>
                                <% } %>
                            </div>
                        </div>

                        <div class="product-actions">
                            <form action="/add-to-cart/<%= products[i].id %>" method="POST" class="d-flex flex-column align-items-center">
                                
                                <div class="input-group mb-3" style="max-width: 140px;">
                                    
                                    <button 
                                        type="button"
                                        class="btn btn-outline-secondary"
                                        onclick="
                                            const input = document.getElementById('qty-<%= products[i].id %>');
                                            input.value = Math.max(1, Number(input.value) - 1);
                                            updateHidden(<%= products[i].id %>);
                                        "
                                    >-</button>

                                    <input 
                                        id="qty-<%= products[i].id %>" 
                                        type="number"
                                        class="form-control text-center"
                                        value="1"
                                        min="1"
                                        oninput="
                                            this.value = this.value.replace(/[^0-9]/g, '');
                                            updateHidden(<%= products[i].id %>);
                                        "
                                    >

                                    <button 
                                        type="button"
                                        class="btn btn-outline-secondary"
                                        onclick="
                                            const input = document.getElementById('qty-<%= products[i].id %>');
                                            input.value = Number(input.value) + 1;
                                            updateHidden(<%= products[i].id %>);
                                        "
                                    >+</button>
                                </div>

                                <input 
                                    type="hidden" 
                                    name="quantity" 
                                    id="quantity-<%= products[i].id %>" 
                                    value="1"
                                >
                                
                                <button type="submit" class="btn btn-custom-olive">
                                    Add to Cart
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <script>
                    function updateHidden(id) {
                        const visible = document.getElementById('qty-' + id);
                        const hidden = document.getElementById('quantity-' + id);
                        hidden.value = visible.value;
                    }
                </script>
            <% } %>

        </div> </div> <%- include("partials/footer") %>
    
</body>
</html>